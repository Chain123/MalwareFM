import sys
import os
import json
import argparse


parser = argparse.ArgumentParser()
parser.add_argument("-a", "--allname",
                    help="JSON file that stores existing features")
parser.add_argument(
    "-d", "--directory", help="JSON file directory where new features may be extracted")

newadd=[]
args = parser.parse_args()

if args.directory:
    arr = os.listdir(args.directory)
    if args.allname:
        allfeature = json.load(open(args.allname))
    else:
        allfeature = []
    allfeature = set(allfeature)
    number_of_file = 0
    for filename in arr:
        # print(filename)
        file = json.load(open(args.directory+'/'+filename))
        if number_of_file%1000 == 0:
            print("---------")
            print("Processing nubmer: " + str(number_of_file))
            print("Current feature length: " + str(len(allfeature)))
        number_of_file +=1
        for Attributes in file:
            if Attributes != 'url':
                for feature in file[Attributes]:
                    allfeature.add(feature)
    allfeature = list(allfeature)
    with open("../data/updatedallfeature.json",'w') as myfile:
        json.dump(allfeature,myfile)
    

    # with open("../data/newadded.json",'w') as myfile:
    #     json.dump(newadd,myfile,indent=4,sort_keys=True)

